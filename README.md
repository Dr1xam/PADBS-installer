# Proxmox Auto-Deployment: Base Services

> –ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –º–∞—à–∏–Ω —É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ Proxmox VE. –ó–∞–±–µ–∑–ø–µ—á—É—î –ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –º–∞—à–∏–Ω —ñ–∑ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º –ø—Ä–æ–≥—Ä–∞–º–Ω–∏–º –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è–º.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

### Virtualization & System
- **Proxmox VE** - –¶—ñ–ª—å–æ–≤–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –≤—ñ—Ä—Ç—É–∞–ª—ñ–∑–∞—Ü—ñ—ó (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è CLI `qm`, `pct`).
- **Ubuntu Server** - –ë–∞–∑–æ–≤–∞ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —à–∞–±–ª–æ–Ω—É.
- **QEMU Guest Agent** - –í–∑–∞—î–º–æ–¥—ñ—è —Ö–æ—Å—Ç–∞ –∑ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ—é –º–∞—à–∏–Ω–æ—é.
- **Cloud-Init** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–µ—Ä–µ–∂—ñ –ø—Ä–∏ –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—ñ.

### Scripting & Tools
- **Bash** - –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—ó —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥.
- **Python 3** - –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ (–ø–∞—Ä—Å–∏–Ω–≥ –≤–µ—Ä—Å—ñ–π, HTTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ —Ñ–∞–π–ª—ñ–≤).
- **Aria2** - –ë–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö –∞—Ä—Ö—ñ–≤—ñ–≤.
- **Whiptail** - –ì—Ä–∞—Ñ—ñ—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –¥–ª—è –≤–∏–±–æ—Ä—É –≤–µ—Ä—Å—ñ–π (—É —Ä–æ–∑—à–∏—Ä–µ–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ).

### Application
- **Rocket.Chat** - –¶—ñ–ª—å–æ–≤–∏–π —Å–µ—Ä–≤—ñ—Å –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è.
- **Snapd** - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç—ñ–≤, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó —Å–µ—Ä–≤–µ—Ä–∞ —á–∞—Ç—É.

##  –ó–∞–ø—É—Å–∫ –ø—Ä–æ—î–∫—Ç—É

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏
- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π **Proxmox VE**.
- **Root-–¥–æ—Å—Ç—É–ø** –¥–æ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É Proxmox.
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—É (–¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è `aria2` —Ç–∞ –æ–±—Ä–∞–∑—ñ–≤).
- –í—ñ–ª—å–Ω–µ –º—ñ—Å—Ü–µ —É —Å—Ö–æ–≤–∏—â—ñ `local-lvm` (–ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è VM).

### –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

1.  **–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å–∫—Ä–∏–ø—Ç —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó (`download.sh`) –Ω–∞ —Å–µ—Ä–≤–µ—Ä.**

2.  **–ó–∞–ø—É—Å—Ç—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó:**
    ```bash
    bash -c "$(curl -fsSL  https://raw.githubusercontent.com/Dr1xam/PADBS/refs/heads/main/download.sh)"
    ```

    **–©–æ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:**
    1.  –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è `aria2` (—è–∫—â–æ –≤—ñ–¥—Å—É—Ç–Ω—è) –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
    2.  –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–¥—ñ–ª–µ–Ω–æ–≥–æ –∞—Ä—Ö—ñ–≤—É —à–∞–±–ª–æ–Ω—É (`part_archive_*`) —Ç–∞ —Å–∫—Ä–∏–ø—Ç—ñ–≤ . (–î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä—É `/var/lib/vz/dump`).
    3.  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ç–∞ —Å–∫–ª–µ—é–≤–∞–Ω–Ω—è –±–µ–∫–∞–ø—É (`part_archive_*`) —É —Ñ–∞–π–ª `.vma.zst`.
    4.  –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω—É —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è (`src/install.sh`).
    5.  –ü—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª—ñ–≤ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–∑ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–∏–¥–∞–ª—è—î –ø–æ–ª–æ–º–∞–Ω–∏–π —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä.

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

–ü—Ä–æ—Ü–µ—Å —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó —Ä–æ–∑–±–∏—Ç–∏–π –Ω–∞ –º–æ–¥—É–ª—ñ, —è–∫—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ:

### 1. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (`make-vm-settings.sh`)
-   **–ü–æ—à—É–∫ ID:** –°–∫—Ä–∏–ø—Ç –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—ñ–ª—å–Ω—ñ VM ID (—É –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ 100M+).
-   **–ú–µ—Ä–µ–∂–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î —à–ª—é–∑ (`GATEWAY`) —Ç–∞ —Å–∫–∞–Ω—É—î –ø—ñ–¥–º–µ—Ä–µ–∂—É –¥–ª—è –ø–æ—à—É–∫—É –≤—ñ–ª—å–Ω–æ—ó IP-–∞–¥—Ä–µ—Å–∏.
-   **–ö–æ–Ω—Ñ—ñ–≥:** –°—Ç–≤–æ—Ä—é—î —Ñ–∞–π–ª `vm.conf` —ñ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤ (4 Core, 4GB RAM, 50GB Disk).

### 2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—É (`make-template.sh`)
-   –í—ñ–¥–Ω–æ–≤–ª—é—î VM —ñ–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ–≥–æ –±–µ–∫–∞–ø—É `vzdump-qemu-*.vma.zst`.
-   –ü—Ä–∏—Å–≤–æ—é—î —ñ–º'—è `deploy-template`.
-   –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —É `src/make_template.log`.

### 3. –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Rocket.Chat (`make-rocketchat.sh`)
-   **–ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è:** –°—Ç–≤–æ—Ä—é—î "Linked Clone" –∑ —à–∞–±–ª–æ–Ω—É.
-   **–†–µ—Å–∞–π–∑:** –†–æ–∑—à–∏—Ä—é—î –¥–∏—Å–∫ –¥–æ 50 –ì–ë.
-   **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:** –ü—Ä–æ–ø–∏—Å—É—î IP, Gateway —Ç–∞ DNS —á–µ—Ä–µ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Proxmox.
-   **–Ü–Ω—Å—Ç–∞–ª—è—Ü—ñ—è:**
    -   –ü—ñ–¥—ñ–π–º–∞—î —Ç–∏–º—á–∞—Å–æ–≤–∏–π Python HTTP-—Å–µ—Ä–≤–µ—Ä –Ω–∞ —Ö–æ—Å—Ç—ñ (–ø–æ—Ä—Ç 8888).
    -   –ó–º—É—à—É—î VM –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó —á–µ—Ä–µ–∑ `qm guest exec`.
    -   –í—Å—Ç–∞–Ω–æ–≤–ª—é—î `snapd` —Ç–∞ `rocketchat-server`.

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –õ–æ–≥–∏

–£—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è —É –ª–æ–≥-—Ñ–∞–π–ª–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `src/`:

```bash
# –õ–æ–≥ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—É
tail -f src/make_template.log

# –õ–æ–≥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ VM
tail -f src/deploy_rocketchat_vm.log

# –õ–æ–≥ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ VM (—ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—è —á–∞—Ç—É)
tail -f src/deploy_rocketchat.log
```
## –í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –°–∫—Ä–∏–ø—Ç –∑–∞–≤–∏—Å –Ω–∞ "–û—á—ñ–∫—É—é –ø–æ–≤–Ω–æ—ó –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ VM..."
–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ —Ö–æ—Å—Ç –Ω–µ –º–æ–∂–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è –∑ QEMU Agent –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ VM.

1.  –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å VM —É Proxmox GUI.
2.  –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Å–µ—Ä–≤—ñ—Å `qemu-guest-agent` –∑–∞–ø—É—â–µ–Ω–∏–π –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≥–æ—Å—Ç—å–æ–≤–æ—ó –û–° (—è–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ).

### –ü–æ–º–∏–ª–∫–∞ "Network is unreachable" –∞–±–æ IP –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
–Ø–∫—â–æ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–º—ñ–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —à–ª—é–∑:

1.  –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–µ—Ä–µ–∂—ñ —Ö–æ—Å—Ç–∞.
2.  –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª `vm.conf` (–ø—ñ—Å–ª—è –π–æ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó) –∞–±–æ –∑–∞–¥–∞–π—Ç–µ `AUTO_GW` –≤—Ä—É—á–Ω—É –≤ —Å–∫—Ä–∏–ø—Ç—ñ `make-vm-settings.sh`.

### –ü—Ä–æ–±–ª–µ–º–∏ –∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º (Checksum error)
–Ø–∫—â–æ `download.sh` –ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ –ø–æ–º–∏–ª–∫—É —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª—ñ–≤:

```bash
# –í–∏–¥–∞–ª—ñ—Ç—å —Ç–∏–º—á–∞—Å–æ–≤—ñ —Ñ–∞–π–ª–∏ —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É
rm -rf download_buffer
rm -f *.vma.zst
./download.sh
```

## –í–∏–¥–∞–ª–µ–Ω–Ω—è —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä–∞



```bash
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –≤ –¥–µ—Ä–∏–∫—Ç–æ—Ä—ñ—é 
cd /var/lib/vz/dump
# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —ñ–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä–∞ 
ls
# –í–∏–≤—ñ–¥ –∫–æ–º–∞–Ω–¥–∏
... src
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –≤ src
cd src
```
 

